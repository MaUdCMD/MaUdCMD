<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Code</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .selection-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
        }
        
        .selection-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #8a2be2;
            text-align: center;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        
        .selection-subtitle {
            font-size: 1rem;
            margin-bottom: 2rem;
            color: #aaa;
            text-align: center;
        }
        
        .editors-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .editor-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #2d2d2d;
            width: 150px;
        }
        
        .editor-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .editor-option.selected {
            border-color: #8a2be2;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.7);
            background: rgba(138, 43, 226, 0.1);
        }
        
        .editor-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #8a2be2;
        }
        
        .editor-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .continue-btn {
            padding: 12px 40px;
            background: #8a2be2;
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        }
        
        .continue-btn:hover {
            background: #6a1bb5;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.8);
            transform: scale(1.05);
        }
        
        .continue-btn:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        .editor-screen {
            display: none;
            flex-direction: column;
            height: 100vh;
            background: #1a1a1a;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #2d2d2d;
            border-bottom: 2px solid #8a2be2;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.3);
        }
        
        .editor-title {
            font-size: 1.5rem;
            color: #8a2be2;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .line-search-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .line-search-input {
            padding: 8px 12px;
            background: #333;
            border: 1px solid #555;
            border-radius: 5px;
            color: #fff;
            font-size: 0.9rem;
            width: 150px;
        }
        
        .line-search-input::placeholder {
            color: #888;
        }
        
        .line-search-btn {
            padding: 8px 16px;
            background: #8a2be2;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .line-search-btn:hover {
            background: #6a1bb5;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #ff4444;
            color: #fff;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .editor-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .code-panel {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .editor-tabs {
            display: flex;
            background: #2d2d2d;
            border-bottom: 1px solid #444;
            overflow-x: auto;
        }
        
        .editor-tab {
            padding: 12px 20px;
            background: #2d2d2d;
            border: none;
            color: #aaa;
            cursor: pointer;
            border-right: 1px solid #444;
            transition: all 0.2s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .editor-tab.active {
            background: #1a1a1a;
            color: #8a2be2;
            border-bottom: 2px solid #8a2be2;
        }
        
        .editor-container {
            flex: 1;
            display: none;
            position: relative;
        }
        
        .editor-container.active {
            display: block;
        }
        
        .editor-wrapper {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            display: flex;
            background: #1e1e1e;
            border: 2px solid #333;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .line-numbers {
            background: #1e1e1e;
            color: #6a6a6a;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 21px;
            padding: 15px 8px 15px 15px;
            border-right: 1px solid #333;
            text-align: right;
            user-select: none;
            overflow: hidden;
            width: 60px;
            flex-shrink: 0;
        }
        
        .line-number {
            height: 21px;
            display: block;
        }
        
        .line-number.highlighted {
            background: rgba(138, 43, 226, 0.3);
            color: #8a2be2;
            font-weight: bold;
        }
        
        .editor-content {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }
        
        .code-input-container {
            position: relative;
            flex: 1;
            overflow: auto;
        }
        
        .code-editor {
            width: 100%;
            height: 100%;
            background: transparent;
            color: #ffffff;
            border: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 21px;
            tab-size: 4;
            caret-color: #fff;
            position: relative;
            z-index: 2;
            overflow: auto;
            white-space: pre;
        }
        
        .code-highlight {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #1e1e1e;
            pointer-events: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 21px;
            white-space: pre;
            overflow: hidden;
            z-index: 1;
        }
        
        .code-line {
            display: block;
            min-height: 21px;
        }
        
        .code-line.highlighted {
            background: rgba(138, 43, 226, 0.3) !important;
            animation: lineHighlight 4s ease-in-out;
        }
        
        @keyframes lineHighlight {
            0% { background: rgba(138, 43, 226, 0.8); }
            70% { background: rgba(138, 43, 226, 0.3); }
            100% { background: transparent; }
        }
        
        .editor-wrapper:focus-within {
            border-color: #8a2be2;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        
        .clear-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4444;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 4;
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .editor-wrapper:hover .clear-btn {
            opacity: 1;
        }
        
        .clear-btn:hover {
            background: #ff6666;
            transform: scale(1.05);
        }
        
        .run-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 30px;
            background: #8a2be2;
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.7);
            z-index: 100;
        }
        
        .run-button:hover {
            background: #6a1bb5;
            box-shadow: 0 0 25px rgba(138, 43, 226, 0.9);
            transform: scale(1.05);
        }
        
        .preview-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 1000;
            display: none;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #2d2d2d;
            border-bottom: 2px solid #8a2be2;
        }
        
        .preview-title {
            font-size: 1.5rem;
            color: #8a2be2;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .console-btn {
            padding: 8px 16px;
            background: #8a2be2;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .console-btn:hover {
            background: #6a1bb5;
        }
        
        .console-btn.active {
            background: #6a1bb5;
        }
        
        .close-preview {
            padding: 8px 16px;
            background: #8a2be2;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .preview-content {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        
        .preview-frame {
            width: 100%;
            flex: 1;
            border: none;
            background: #fff;
        }
        
        .console-panel {
            background: #1e1e1e;
            border-top: 2px solid #8a2be2;
            display: none;
            flex-direction: column;
            height: 300px;
        }
        
        .console-panel.active {
            display: flex;
        }
        
        .console-header {
            padding: 10px 15px;
            background: #2d2d2d;
            color: #8a2be2;
            font-weight: bold;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .console-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .console-filter {
            padding: 4px 8px;
            background: #333;
            border: 1px solid #555;
            border-radius: 3px;
            color: #fff;
            font-size: 0.8rem;
            width: 150px;
        }
        
        .console-levels {
            display: flex;
            gap: 5px;
        }
        
        .level-btn {
            padding: 4px 8px;
            background: #444;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            opacity: 0.6;
        }
        
        .level-btn.active {
            opacity: 1;
            background: #8a2be2;
        }
        
        .console-btn-small {
            padding: 4px 8px;
            background: #444;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .copy-console-btn {
            padding: 4px 8px;
            background: #444;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .console-output {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            background: #1a1a1a;
            white-space: pre-wrap;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        .console-line {
            margin: 2px 0;
            line-height: 1.4;
            padding: 2px 5px;
            border-radius: 3px;
            cursor: text;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        .console-line:hover {
            background: #2a2a2a;
        }
        
        .console-timestamp {
            color: #666;
            font-size: 0.75rem;
            margin-right: 10px;
            user-select: none;
        }

        .console-log { color: #ffffff; }
        .console-error { color: #ff4444; }
        .console-warn { color: #ffaa00; }
        .console-info { color: #8888ff; }
        .console-debug { color: #888888; }

        .copy-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #8a2be2;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .copy-notification.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="selection-screen" id="selectionScreen">
        <h1 class="selection-title">–ö–∞–∫–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –≤–∞–º –Ω—É–∂–Ω—ã?</h1>
        <div class="selection-subtitle">–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ</div>
        <div class="editors-selection">
            <div class="editor-option" data-editor="html">
                <div class="editor-icon">{ }</div>
                <div class="editor-name">HTML</div>
            </div>
            <div class="editor-option" data-editor="css">
                <div class="editor-icon">#</div>
                <div class="editor-name">CSS</div>
            </div>
            <div class="editor-option" data-editor="js">
                <div class="editor-icon">( )</div>
                <div class="editor-name">JavaScript</div>
            </div>
        </div>
        <button class="continue-btn" id="continueBtn" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    
    <div class="editor-screen" id="editorScreen">
        <div class="editor-header">
            <div class="editor-title">
                Start Code
                <div class="line-search-container">
                    <input type="text" class="line-search-input" id="lineSearchInput" placeholder="–ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏" maxlength="4">
                    <button class="line-search-btn" id="lineSearchBtn">–ù–∞–π—Ç–∏</button>
                </div>
            </div>
        </div>
        <div class="editor-layout">
            <div class="code-panel">
                <div class="editor-tabs" id="editorTabs"></div>
                
                <div class="editor-container" id="html-editor">
                    <div class="editor-wrapper">
                        <div class="line-numbers" id="html-line-numbers">
                            <span class="line-number">1</span>
                        </div>
                        <div class="editor-content">
                            <div class="code-input-container">
                                <textarea class="code-editor" id="html-code" spellcheck="false" placeholder="–í–≤–µ–¥–∏—Ç–µ HTML –∫–æ–¥"></textarea>
                                <div class="code-highlight" id="html-highlight"></div>
                            </div>
                            <button class="clear-btn" data-editor="html">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <div class="editor-container" id="css-editor">
                    <div class="editor-wrapper">
                        <div class="line-numbers" id="css-line-numbers">
                            <span class="line-number">1</span>
                        </div>
                        <div class="editor-content">
                            <div class="code-input-container">
                                <textarea class="code-editor" id="css-code" spellcheck="false" placeholder="–í–≤–µ–¥–∏—Ç–µ CSS –∫–æ–¥"></textarea>
                                <div class="code-highlight" id="css-highlight"></div>
                            </div>
                            <button class="clear-btn" data-editor="css">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <div class="editor-container" id="js-editor">
                    <div class="editor-wrapper">
                        <div class="line-numbers" id="js-line-numbers">
                            <span class="line-number">1</span>
                        </div>
                        <div class="editor-content">
                            <div class="code-input-container">
                                <textarea class="code-editor" id="js-code" spellcheck="false" placeholder="–í–≤–µ–¥–∏—Ç–µ JavaScript –∫–æ–¥"></textarea>
                                <div class="code-highlight" id="js-highlight"></div>
                            </div>
                            <button class="clear-btn" data-editor="js">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="run-button" id="runButton">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div class="preview-fullscreen" id="previewFullscreen">
        <div class="preview-header">
            <div class="preview-title">
                –†–µ–∑—É–ª—å—Ç–∞—Ç
                <button class="console-btn" id="consoleToggle">Console</button>
            </div>
            <button class="close-preview" id="closePreview">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="preview-content">
            <iframe class="preview-frame" id="preview"></iframe>
            <div class="console-panel" id="consolePanel">
                <div class="console-header">
                    –ö–æ–Ω—Å–æ–ª—å
                    <div class="console-controls">
                        <input type="text" class="console-filter" id="consoleFilter" placeholder="–§–∏–ª—å—Ç—Ä...">
                        <div class="console-levels">
                            <button class="level-btn active" data-level="all">All</button>
                            <button class="level-btn active" data-level="log">Log</button>
                            <button class="level-btn active" data-level="warn">Warn</button>
                            <button class="level-btn active" data-level="error">Error</button>
                            <button class="level-btn active" data-level="info">Info</button>
                            <button class="level-btn active" data-level="debug">Debug</button>
                        </div>
                        <button class="console-btn-small" id="clearConsole">–û—á–∏—Å—Ç–∏—Ç—å</button>
                        <button class="copy-console-btn" id="copyConsole">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
                <div class="console-output" id="consoleOutput"></div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">–°—Ç—Ä–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>
    <div class="copy-notification" id="copyNotification">–¢–µ–∫—Å—Ç –∫–æ–Ω—Å–æ–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const selectionScreen = document.getElementById('selectionScreen');
            const editorScreen = document.getElementById('editorScreen');
            const continueBtn = document.getElementById('continueBtn');
            const editorTabs = document.getElementById('editorTabs');
            const runButton = document.getElementById('runButton');
            const previewFullscreen = document.getElementById('previewFullscreen');
            const preview = document.getElementById('preview');
            const closePreview = document.getElementById('closePreview');
            const consoleToggle = document.getElementById('consoleToggle');
            const consolePanel = document.getElementById('consolePanel');
            const consoleOutput = document.getElementById('consoleOutput');
            const clearConsole = document.getElementById('clearConsole');
            const copyConsole = document.getElementById('copyConsole');
            const lineSearchInput = document.getElementById('lineSearchInput');
            const lineSearchBtn = document.getElementById('lineSearchBtn');
            const notification = document.getElementById('notification');
            const copyNotification = document.getElementById('copyNotification');

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const selectedEditors = { html: false, css: false, js: false };
            const consoleState = {
                logs: [],
                activeLevels: new Set(['all', 'log', 'warn', 'error', 'info', 'debug']),
                filterText: ''
            };

            // –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–°–ß–Å–¢ –°–¢–†–û–ö
            function updateLineNumbers(editorType) {
                const textarea = document.getElementById(editorType + '-code');
                const lineNumbers = document.getElementById(editorType + '-line-numbers');
                
                if (!textarea || !lineNumbers) return;

                const lines = textarea.value.split('\n');
                const lineCount = Math.max(1, lines.length);
                
                lineNumbers.innerHTML = '';
                
                for (let i = 1; i <= lineCount; i++) {
                    const lineNumber = document.createElement('span');
                    lineNumber.className = 'line-number';
                    lineNumber.textContent = i;
                    lineNumber.setAttribute('data-line-number', i);
                    lineNumbers.appendChild(lineNumber);
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
            function initializeEditor(editorType) {
                const textarea = document.getElementById(editorType + '-code');
                const highlight = document.getElementById(editorType + '-highlight');
                
                if (!textarea || !highlight) return;

                // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                const updateEditor = () => {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫
                    updateLineNumbers(editorType);
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
                    let code = textarea.value;
                    let highlightedCode = code;
                    
                    try {
                        if (editorType === 'html') {
                            highlightedCode = hljs.highlight(code, { language: 'xml' }).value;
                        } else if (editorType === 'css') {
                            highlightedCode = hljs.highlight(code, { language: 'css' }).value;
                        } else if (editorType === 'js') {
                            highlightedCode = hljs.highlight(code, { language: 'javascript' }).value;
                        }
                    } catch (e) {
                        // –ï—Å–ª–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
                    }
                    
                    highlight.innerHTML = highlightedCode.split('\n')
                        .map(line => `<div class="code-line">${line || ' '}</div>`)
                        .join('');
                };

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                textarea.addEventListener('input', updateEditor);
                
                textarea.addEventListener('scroll', () => {
                    highlight.scrollTop = textarea.scrollTop;
                    highlight.scrollLeft = textarea.scrollLeft;
                    const lineNumbers = document.getElementById(editorType + '-line-numbers');
                    if (lineNumbers) {
                        lineNumbers.scrollTop = textarea.scrollTop;
                    }
                });

                textarea.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                        const start = this.selectionStart;
                        const end = this.selectionEnd;
                        this.value = this.value.substring(0, start) + '    ' + this.value.substring(end);
                        this.selectionStart = this.selectionEnd = start + 4;
                        updateEditor();
                    }
                });

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                updateEditor();
            }

            // –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–ò–°–ö –°–¢–†–û–ö–ò
            function searchLine() {
                const lineNumber = parseInt(lineSearchInput.value);
                
                if (isNaN(lineNumber) || lineNumber < 1) {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏');
                    return;
                }

                const activeTab = document.querySelector('.editor-tab.active');
                if (!activeTab) {
                    showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä');
                    return;
                }

                const editorType = activeTab.getAttribute('data-editor');
                const textarea = document.getElementById(editorType + '-code');
                const highlight = document.getElementById(editorType + '-highlight');
                const lineNumbers = document.getElementById(editorType + '-line-numbers');
                
                if (!textarea || !highlight || !lineNumbers) return;

                const lines = textarea.value.split('\n');
                
                if (lineNumber > lines.length) {
                    showNotification(`–°—Ç—Ä–æ–∫–∞ ${lineNumber} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: ${lines.length}`);
                    return;
                }

                // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—ã–¥–µ–ª–µ–Ω–∏–π
                clearHighlights();

                // –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏
                const lineNumberElement = lineNumbers.querySelector(`[data-line-number="${lineNumber}"]`);
                if (lineNumberElement) {
                    lineNumberElement.classList.add('highlighted');
                }

                // –í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ —Å—Ç—Ä–æ–∫–µ
                const codeLines = highlight.querySelectorAll('.code-line');
                if (codeLines[lineNumber - 1]) {
                    codeLines[lineNumber - 1].classList.add('highlighted');
                }

                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å—Ç—Ä–æ–∫–µ
                const lineHeight = 21;
                const scrollPosition = (lineNumber - 3) * lineHeight;
                
                textarea.scrollTop = Math.max(0, scrollPosition);
                highlight.scrollTop = Math.max(0, scrollPosition);
                lineNumbers.scrollTop = Math.max(0, scrollPosition);

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    clearHighlights();
                }, 4000);

                showNotification(`–ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ ${lineNumber}`);
            }

            function clearHighlights() {
                // –°–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏–π –≤–æ –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö
                document.querySelectorAll('.line-number.highlighted').forEach(el => {
                    el.classList.remove('highlighted');
                });
                document.querySelectorAll('.code-line.highlighted').forEach(el => {
                    el.classList.remove('highlighted');
                });
            }

            function showNotification(message) {
                notification.textContent = message;
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 3000);
            }

            function showCopyNotification() {
                copyNotification.classList.add('show');
                setTimeout(() => copyNotification.classList.remove('show'), 2000);
            }

            // –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –¢–ï–ö–°–¢–ê –ò–ó –ö–û–ù–°–û–õ–ò
            function copyConsoleText() {
                const textToCopy = getConsoleText();
                if (textToCopy) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showCopyNotification();
                    }).catch(err => {
                        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                        const textArea = document.createElement('textarea');
                        textArea.value = textToCopy;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showCopyNotification();
                    });
                }
            }

            function getConsoleText() {
                let consoleText = '';
                consoleState.logs.forEach(log => {
                    if (!consoleState.activeLevels.has('all') && !consoleState.activeLevels.has(log.method)) {
                        return;
                    }
                    
                    if (consoleState.filterText && !log.args.join(' ').toLowerCase().includes(consoleState.filterText.toLowerCase())) {
                        return;
                    }

                    const timestamp = new Date(log.timestamp).toLocaleTimeString();
                    consoleText += `${timestamp} ${log.method.toUpperCase()}: ${log.args.join(' ')}\n`;
                });
                return consoleText.trim();
            }

            // –í—ã–±–æ—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
            document.querySelectorAll('.editor-option').forEach(option => {
                option.addEventListener('click', function() {
                    const editor = this.getAttribute('data-editor');
                    selectedEditors[editor] = !selectedEditors[editor];
                    this.classList.toggle('selected');
                    continueBtn.disabled = !Object.values(selectedEditors).some(val => val);
                });
            });

            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
            continueBtn.addEventListener('click', function() {
                selectionScreen.style.display = 'none';
                editorScreen.style.display = 'flex';
                createEditorTabs();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
                Object.keys(selectedEditors).forEach(editor => {
                    if (selectedEditors[editor]) {
                        initializeEditor(editor);
                    }
                });
            });

            // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
            function createEditorTabs() {
                editorTabs.innerHTML = '';
                
                ['html', 'css', 'js'].forEach(editor => {
                    if (selectedEditors[editor]) {
                        const tab = document.createElement('button');
                        tab.className = 'editor-tab';
                        tab.textContent = getEditorName(editor);
                        tab.setAttribute('data-editor', editor);
                        tab.addEventListener('click', function() {
                            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏
                            document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
                            document.querySelectorAll('.editor-container').forEach(c => c.classList.remove('active'));
                            this.classList.add('active');
                            document.getElementById(editor + '-editor').classList.add('active');
                        });
                        editorTabs.appendChild(tab);
                    }
                });
                
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
                const firstTab = editorTabs.querySelector('.editor-tab');
                if (firstTab) {
                    firstTab.click();
                }
            }

            function getEditorName(editor) {
                const names = { html: 'HTML', css: 'CSS', js: 'JavaScript' };
                return names[editor] || editor;
            }

            // –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏
            lineSearchBtn.addEventListener('click', searchLine);
            lineSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchLine();
            });

            // –ó–∞–ø—É—Å–∫ –∫–æ–¥–∞
            runButton.addEventListener('click', runCode);

            function runCode() {
                const htmlCode = selectedEditors.html ? document.getElementById('html-code').value : '';
                const cssCode = selectedEditors.css ? document.getElementById('css-code').value : '';
                const jsCode = selectedEditors.js ? document.getElementById('js-code').value : '';

                const previewDoc = preview.contentDocument || preview.contentWindow.document;
                
                // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Å–æ–ª–∏
                consoleState.logs = [];
                updateConsole();

                const fullHtml = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        ${cssCode}
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    ${htmlCode || '<div style="text-align: center; padding: 50px; color: #666;">–ù–∞–ø–∏—à–∏—Ç–µ HTML –∫–æ–¥</div>'}
    <script>
        // –ü–û–õ–ù–´–ô –ü–ï–†–ï–•–í–ê–¢ –í–°–ï–• –ú–ï–¢–û–î–û–í –ö–û–ù–°–û–õ–ò
        (function() {
            const originalConsole = {
                log: console.log,
                error: console.error,
                warn: console.warn,
                info: console.info,
                debug: console.debug,
                table: console.table,
                dir: console.dir,
                time: console.time,
                timeEnd: console.timeEnd,
                count: console.count,
                assert: console.assert,
                clear: console.clear,
                group: console.group,
                groupEnd: console.groupEnd,
                groupCollapsed: console.groupCollapsed,
                trace: console.trace
            };

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ
            const sendToConsole = (method, args) => {
                try {
                    window.parent.postMessage({
                        type: 'console',
                        method: method,
                        args: Array.from(args).map(arg => {
                            if (typeof arg === 'object' && arg !== null) {
                                try {
                                    if (arg instanceof Error) {
                                        return arg.toString() + '\\n' + arg.stack;
                                    }
                                    if (arg instanceof HTMLElement) {
                                        return arg.outerHTML;
                                    }
                                    if (Array.isArray(arg)) {
                                        return '[' + arg.map(item => 
                                            typeof item === 'object' ? JSON.stringify(item) : String(item)
                                        ).join(', ') + ']';
                                    }
                                    return JSON.stringify(arg, null, 2);
                                } catch (e) {
                                    return String(arg);
                                }
                            }
                            return String(arg);
                        })
                    }, '*');
                } catch (e) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
                }
            };

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Å–æ–ª–∏
            const methods = ['log', 'error', 'warn', 'info', 'debug', 'table', 'dir', 'time', 'timeEnd', 'count', 'assert', 'group', 'groupEnd', 'groupCollapsed', 'trace'];
            
            methods.forEach(method => {
                console[method] = function(...args) {
                    // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
                    try {
                        originalConsole[method].apply(console, args);
                    } catch (e) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
                    }
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –Ω–∞—à—É –∫–æ–Ω—Å–æ–ª—å
                    sendToConsole(method, args);
                };
            });

            // –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π –¥–ª—è console.clear
            console.clear = function() {
                originalConsole.clear.call(console);
                sendToConsole('clear', ['Console cleared']);
            };

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ JavaScript
            window.addEventListener('error', function(e) {
                sendToConsole('error', [
                    'Uncaught ' + (e.error?.name || 'Error') + ': ' + e.message + 
                    '\\nAt: ' + e.filename + ':' + e.lineno + ':' + e.colno +
                    (e.error?.stack ? '\\nStack: ' + e.error.stack : '')
                ]);
            });

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Promise rejections
            window.addEventListener('unhandledrejection', function(e) {
                sendToConsole('error', [
                    'Unhandled Promise Rejection: ' + e.reason +
                    (e.reason?.stack ? '\\nStack: ' + e.reason.stack : '')
                ]);
            });

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç console.table –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
            const originalTable = console.table;
            console.table = function(data) {
                originalTable.call(console, data);
                if (Array.isArray(data)) {
                    const tableData = data.map(item => {
                        if (typeof item === 'object') {
                            return JSON.stringify(item, null, 2);
                        }
                        return String(item);
                    });
                    sendToConsole('table', ['Array:', ...tableData]);
                } else if (typeof data === 'object') {
                    const tableData = Object.entries(data).map(([key, value]) => {
                        return key + ': ' + (typeof value === 'object' ? JSON.stringify(value, null, 2) : String(value));
                    });
                    sendToConsole('table', ['Object:', ...tableData]);
                } else {
                    sendToConsole('table', [String(data)]);
                }
            };

        })();

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥
        try {
            ${jsCode}
        } catch (e) {
            console.error('Execution error:', e);
        }

        // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        console.log('Page loaded successfully');
        console.info('DOM ready at:', new Date().toLocaleTimeString());
    <\/script>
</body>
</html>`;

                previewDoc.open();
                previewDoc.write(fullHtml);
                previewDoc.close();

                previewFullscreen.style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å –µ—Å–ª–∏ –µ—Å—Ç—å JS –∫–æ–¥
                if (jsCode.trim()) {
                    setTimeout(() => {
                        consolePanel.classList.add('active');
                        consoleToggle.classList.add('active');
                    }, 500);
                }
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ iframe
            window.addEventListener('message', function(e) {
                if (e.data && e.data.type === 'console') {
                    consoleState.logs.push({
                        method: e.data.method,
                        args: e.data.args,
                        timestamp: Date.now()
                    });
                    updateConsole();
                }
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏
            function updateConsole() {
                consoleOutput.innerHTML = '';
                
                const filteredLogs = consoleState.logs.filter(log => {
                    if (!consoleState.activeLevels.has('all') && !consoleState.activeLevels.has(log.method)) {
                        return false;
                    }
                    
                    if (consoleState.filterText) {
                        const text = log.args.join(' ').toLowerCase();
                        return text.includes(consoleState.filterText.toLowerCase());
                    }
                    
                    return true;
                });

                filteredLogs.forEach(log => {
                    const line = document.createElement('div');
                    line.className = `console-line console-${log.method}`;
                    
                    const timestamp = new Date(log.timestamp).toLocaleTimeString();
                    const content = log.args.join(' ');
                    
                    line.innerHTML = `<span class="console-timestamp">${timestamp}</span> ${content}`;
                    consoleOutput.appendChild(line);
                });
                
                // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–æ–ª—å—é
            consoleToggle.addEventListener('click', function() {
                consolePanel.classList.toggle('active');
                this.classList.toggle('active');
            });

            clearConsole.addEventListener('click', function() {
                consoleState.logs = [];
                updateConsole();
            });

            copyConsole.addEventListener('click', copyConsoleText);

            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const level = this.getAttribute('data-level');
                    
                    if (this.classList.contains('active')) {
                        consoleState.activeLevels.add(level);
                    } else {
                        consoleState.activeLevels.delete(level);
                    }
                    
                    updateConsole();
                });
            });

            document.getElementById('consoleFilter').addEventListener('input', function() {
                consoleState.filterText = this.value;
                updateConsole();
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–≤—å—é
            closePreview.addEventListener('click', function() {
                previewFullscreen.style.display = 'none';
                consolePanel.classList.remove('active');
                consoleToggle.classList.remove('active');
            });

            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    runCode();
                }
                
                if (e.key === 'Escape' && previewFullscreen.style.display === 'block') {
                    previewFullscreen.style.display = 'none';
                }
            });

            // –ö–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏
            document.querySelectorAll('.clear-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const editor = this.getAttribute('data-editor');
                    const textarea = document.getElementById(editor + '-code');
                    if (textarea) {
                        textarea.value = '';
                        initializeEditor(editor);
                    }
                });
            });
        });
    </script>
</body>
</html>
